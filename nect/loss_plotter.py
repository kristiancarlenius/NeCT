import re
import matplotlib.pyplot as plt
from collections import defaultdict
import numpy as np

"""
# Input log as a multiline string
log_data = """
"""

# Extract epoch and avg_loss pairs
pattern = r"epoch=(\d+), avg_loss=([\d.]+)"
matches = re.findall(pattern, log_data)

losses = defaultdict(list)
for e, l in matches:
    losses[int(e)].append(float(l))

# Compute average per epoch
x_1 = sorted(losses.keys())
y_1 = [np.mean(losses[e]) for e in x_1]
"""

x_1 = [i for i in range(151)]
y_1 = [0.107844, 0.023998, 0.013476, 0.011566, 0.009960, 0.009663, 0.008860, 0.008745, 0.008228, 0.008052, 
       0.007581, 0.007299, 0.007170, 0.007098, 0.006995, 0.006840, 0.006901, 0.006583, 0.006600, 0.006528, 
       0.006425, 0.006233, 0.006181, 0.006037, 0.006021, 0.006010, 0.005831, 0.005760, 0.005829, 0.005670, 
       0.005597, 0.005582, 0.005554, 0.005467, 0.005391, 0.005311, 0.005303, 0.005159, 0.005220, 0.005088, 
       0.005141, 0.005046, 0.005024, 0.005035, 0.004970, 0.004979, 0.004897, 0.004930, 0.004874, 0.004821, 
       0.004813, 0.004841, 0.004715, 0.004768, 0.004649, 0.004762, 0.004684, 0.004719, 0.004592, 0.004552, 
       0.004580, 0.004505, 0.004555, 0.004486, 0.004500, 0.004416, 0.004447, 0.004401, 0.004473, 0.004338, 
       0.004363, 0.004340, 0.004314, 0.004309, 0.004325, 0.004286, 0.004250, 0.004272, 0.004214, 0.004196, 
       0.004189, 0.004143, 0.004207, 0.004154, 0.004155, 0.004117, 0.004092, 0.004093, 0.004082, 0.004064, 
       0.004073, 0.004053, 0.004013, 0.004024, 0.004012, 0.004006, 0.003998, 0.003978, 0.003968, 0.003936, 
       0.003940, 0.003933, 0.003919, 0.003901, 0.003890, 0.003887, 0.003873, 0.003866, 0.003847, 0.003862, 
       0.003843, 0.003830, 0.003823, 0.003807, 0.003807, 0.003803, 0.003785, 0.003775, 0.003766, 0.003774, 
       0.003750, 0.003751, 0.003737, 0.003727, 0.003728, 0.003722, 0.003717, 0.003705, 0.003704, 0.003708, 
       0.003697, 0.003682, 0.003685, 0.003670, 0.003670, 0.003660, 0.003662, 0.003651, 0.003651, 0.003648, 
       0.003645, 0.003639, 0.003628, 0.003632, 0.003625, 0.003620, 0.003626, 0.003616, 0.003613, 0.003608, 
       0.003610]

x_2 = [i for i in range(151)]
y_2 = [0.384471, 0.384389, 0.384258, 0.384124, 0.383739, 0.382950, 0.381199, 0.376176, 0.359513, 0.284475,
       0.123835, 0.079901, 0.035968, 0.017340, 0.012128, 0.011576, 0.011498, 0.011324, 0.011093, 0.011345,
       0.011058, 0.010763, 0.009917, 0.009313, 0.008835, 0.008348, 0.008286, 0.008192, 0.007771, 0.007865,
       0.007640, 0.007326, 0.007213, 0.007187, 0.007215, 0.006739, 0.006681, 0.006512, 0.006474, 0.006274,
       0.006311, 0.005984, 0.005851, 0.005914, 0.005691, 0.005719, 0.005512, 0.005687, 0.005591, 0.005460,
       0.005316, 0.005472, 0.005215, 0.005216, 0.005112, 0.005215, 0.005030, 0.005072, 0.004970, 0.004834,
       0.004903, 0.004804, 0.004773, 0.004736, 0.004692, 0.004653, 0.004659, 0.004587, 0.004635, 0.004482,
       0.004456, 0.004512, 0.004431, 0.004406, 0.004353, 0.004381, 0.004286, 0.004272, 0.004219, 0.004248,
       0.004219, 0.004160, 0.004205, 0.004144, 0.004076, 0.004088, 0.004063, 0.004053, 0.003979, 0.004014,
       0.004025, 0.003936, 0.003950, 0.003895, 0.003905, 0.003881, 0.003845, 0.003844, 0.003800, 0.003783,
       0.003773, 0.003730, 0.003746, 0.003700, 0.003694, 0.003688, 0.003663, 0.003653, 0.003634, 0.003629,
       0.003593, 0.003592, 0.003576, 0.003566, 0.003534, 0.003539, 0.003535, 0.003515, 0.003498, 0.003509,
       0.003459, 0.003482, 0.003453, 0.003442, 0.003436, 0.003431, 0.003408, 0.003407, 0.003394, 0.003396,
       0.003383, 0.003372, 0.003365, 0.003352, 0.003341, 0.003337, 0.003337, 0.003315, 0.003316, 0.003320,
       0.003300, 0.003300, 0.003288, 0.003290, 0.003278, 0.003269, 0.003279, 0.003261, 0.003254, 0.003250,
       0.003253]

# Plot both
plt.figure(figsize=(8, 5))
plt.plot(x_1, y_1, marker='o', linewidth=2, markersize=5, label='Run 1')
plt.plot(x_2, y_2, marker='s', linewidth=2, markersize=5, label='Run 2')

# Labels and style
plt.title("Average Loss per Epoch (Comparison)", fontsize=14)
plt.xlabel("Epoch", fontsize=12)
plt.ylabel("Average Loss", fontsize=12)
plt.grid(True, linestyle='--', alpha=0.6)
plt.legend()
plt.tight_layout()
plt.show()